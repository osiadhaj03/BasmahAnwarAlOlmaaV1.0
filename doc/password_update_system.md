# نظام تحديث كلمة السر

## الوصف
تم إضافة وحدة كاملة لتحديث كلمات السر للمستخدمين بطريقة آمنة مع التشفير السليم.

## الملفات المضافة

### 1. `app/Filament/Resources/Users/Schemas/PasswordUpdateForm.php`
نموذج تحديث كلمة السر يتضمن:
- حقل كلمة المرور الجديدة
- حقل تأكيد كلمة المرور
- التحقق من تطابق كلمات المرور
- التحقق من قوة كلمة السر (8 أحرف على الأقل، أحرف كبيرة وصغيرة وأرقام)

### 2. `app/Filament/Resources/Users/Pages/UpdatePassword.php`
صفحة تحديث كلمة السر التي تتضمن:
- عرض نموذج تحديث كلمة السر
- التحقق من صلاحيات المستخدم
- تشفير كلمة المرور باستخدام `Hash::make()`
- إرسال إشعارات النجاح والخطأ

### 3. `resources/views/filament/resources/users/pages/update-password.blade.php`
واجهة المستخدم لصفحة تحديث كلمة السر بتصميم احترافي مع نصائح أمان.

## الملفات المعدلة

### 1. `app/Filament/Resources/Users/UserResource.php`
- إضافة استيراد `UpdatePassword`
- إضافة الطريق الجديد: `'updatePassword' => UpdatePassword::route('/{record}/update-password')`

### 2. `app/Filament/Resources/Users/Pages/ViewUser.php`
- إضافة زر "تحديث كلمة المرور" في صفحة عرض المستخدم
- الزر متاح للمدراء ولكل مستخدم للمستخدمات الخاصة به

### 3. `app/Filament/Resources/Users/Pages/EditUser.php`
- إضافة زر "تحديث كلمة المرور" في صفحة تعديل المستخدم
- نفس صلاحيات ViewUser

### 4. `app/Filament/Resources/Users/Tables/UsersTable.php`
- إضافة زر "تحديث كلمة السر" في جدول المستخدمين
- متاح مباشرة من الجدول للسهولة

## الميزات الأمنية

### 1. التشفير
```php
'password' => Hash::make($data['password']),
```
تستخدم نفس طريقة التشفير المستخدمة في باقي الملفات (bcrypt)

### 2. التحقق من الصلاحيات
- المدراء (admin): يمكنهم تحديث كلمة مرور أي مستخدم
- المعلمون والطلاب: يمكنهم تحديث كلمة مرورهم الخاصة فقط

### 3. التحقق من قوة كلمة السر
- 8 أحرف على الأقل
- أحرف كبيرة وصغيرة
- أرقام
- تطابق كلمات المرور

## كيفية الاستخدام

### للمدراء
1. الذهاب إلى صفحة المستخدمين
2. اختيار المستخدم المراد تحديث كلمته
3. الضغط على زر "تحديث كلمة السر"
4. إدخال كلمة المرور الجديدة وتأكيدها
5. الضغط على زر "تحديث كلمة المرور"

### للمستخدمين (تحديث كلمتهم الخاصة)
1. الذهاب إلى ملفهم الشخصي
2. الضغط على زر "تحديث كلمة المرور"
3. إدخال كلمة المرور الجديدة وتأكيدها
4. الضغط على زر "تحديث كلمة المرور"

## الرسائل والإشعارات

### نجاح التحديث
```
عنوان: نجح التحديث
الرسالة: تم تحديث كلمة المرور بنجاح
اللون: أخضر
```

### عدم التصريح
```
عنوان: غير مصرح
الرسالة: ليس لديك صلاحية لتحديث كلمة مرور هذا المستخدم
اللون: أحمر
```

### خطأ في التحديث
```
عنوان: خطأ
الرسالة: حدث خطأ أثناء تحديث كلمة المرور: [تفاصيل الخطأ]
اللون: أحمر
```

## ملاحظات مهمة

1. **التشفير**: يستخدم نفس الطريقة المستخدمة في النموذج الأساسي (bcrypt)
2. **الأمان**: يتم التحقق من الصلاحيات قبل تحديث كلمة السر
3. **سهولة الاستخدام**: متاح من ثلاث نقاط:
   - زر في جدول المستخدمين
   - زر في صفحة عرض المستخدم
   - زر في صفحة تعديل المستخدم
4. **واجهة حديثة**: تصميم احترافي مع نصائح أمان للمستخدم

## الطرق المستخدمة

### في PasswordUpdateForm
- `TextInput::make()` - لإنشاء حقول الإدخال
- `same()` - للتحقق من تطابق كلمات المرور
- `minLength()` - للتحقق من الحد الأدنى من الأحرف
- `regex()` - للتحقق من قوة كلمة السر

### في UpdatePassword
- `Hash::make()` - لتشفير كلمة المرور
- `Auth::check()` - للتحقق من تسجيل الدخول
- `Auth::user()->type` - للتحقق من نوع المستخدم
- `Notification::make()` - لإرسال الإشعارات
- `update()` - لتحديث بيانات المستخدم

## أمثلة الاستخدام

### تحديث كلمة مرور باستخدام CLI (للاختبار)
```bash
php artisan tinker
>>> $user = User::find(1);
>>> $user->password = bcrypt('NewPassword123');
>>> $user->save();
```

## الاختبار

يمكن اختبار الميزة عن طريق:

1. **اختبار صلاحيات المدراء**: 
   - تسجيل الدخول كمدير
   - الذهاب إلى صفحة تحديث كلمة سر مستخدم آخر
   - يجب أن يكون متاحاً

2. **اختبار صلاحيات المستخدمين العاديين**:
   - تسجيل الدخول كمستخدم عادي
   - محاولة تحديث كلمة مرور مستخدم آخر
   - يجب أن يظهر خطأ "غير مصرح"

3. **اختبار تحديث كلمة المرور الخاصة**:
   - تسجيل الدخول كمستخدم
   - الذهاب إلى صفحة تحديث كلمة السر الخاصة به
   - يجب أن يكون متاحاً

4. **اختبار التشفير**:
   - التحقق من قاعدة البيانات
   - يجب أن تكون كلمة المرور مشفرة بصيغة bcrypt

---

**تم الإنشاء**: 2025-11-12
**الإصدار**: v1.0
